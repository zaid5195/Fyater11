<!DOCTYPE html>
<html lang="ar" dir="rtl" id="htmlRoot">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VATICA Business Suite | Ù…Ù†ØµØ© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ± ÙˆØ¹Ø±ÙˆØ¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„Ø¹Ù…Ù„Ø§Ø¡</title>
    <meta name="description" content="Ù…Ù†ØµØ© VATICA Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„ØµØºÙŠØ±Ø©: Ø£Ù†Ø´Ø¦ ÙÙˆØ§ØªÙŠØ± Ø¶Ø±ÙŠØ¨ÙŠØ©ØŒ Ø¹Ø±ÙˆØ¶ Ø£Ø³Ø¹Ø§Ø±ØŒ ÙˆØ£Ø¯Ø± Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù…Ù„Ø§Ø¦Ùƒ ÙÙŠ Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯ ÙˆØ¨Ø®ØµÙˆØµÙŠØ© ØªØ§Ù…Ø©.">
    
    <!-- ÙƒÙˆØ¯ Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2161407887612919" crossorigin="anonymous"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <style>
        :root { 
            --v-blue: #0f172a; 
            --v-primary: #2563eb; 
            --v-success: #22c55e;
            --v-text: #1e293b; 
            --bg-light: #f1f5f9; 
            --bg-card: white;
            --bg-control: white;
            --border-color: #e2e8f0;
            --input-bg: white;
            --shadow-color: rgba(0,0,0,0.05);
        }
        .dark-mode {
            --v-blue: #1e293b;
            --v-primary: #60a5fa;
            --v-text: #f8fafc;
            --bg-light: #0f172a;
            --bg-card: #1e293b;
            --bg-control: #1e293b;
            --border-color: #334155;
            --input-bg: #334155;
            --shadow-color: rgba(255,255,255,0.1);
        }

        * { box-sizing: border-box; font-family: 'Tajawal', sans-serif; }
        body { margin: 0; background-color: var(--bg-light); color: var(--v-text); transition: background-color 0.3s, color 0.3s; line-height: 1.6; }
        
        .assistant-bar { background: #e0e7ff; color: #3730a3; padding: 10px; font-size: 13px; text-align: center; border-bottom: 1px solid #c7d2fe; }
        header.vatica-nav { background: var(--v-blue); color: white; padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; }
        .vatica-logo { font-size: 26px; font-weight: 700; text-decoration: none; color: white; }
        .vatica-logo span { color: var(--v-primary); }

        .container { display: flex; max-width: 1400px; margin: 20px auto; padding: 0 20px; gap: 30px; }
        aside.controls { width: 320px; background: var(--bg-control); padding: 25px; border-radius: 16px; box-shadow: 0 4px 20px var(--shadow-color); height: fit-content; position: sticky; top: 90px; transition: background-color 0.3s; }
        main.editor { flex: 1; min-width: 0; }

        .card { background: var(--bg-card); padding: 50px; min-height: 297mm; position: relative; box-shadow: 0 10px 40px var(--shadow-color); border-top: 15px solid var(--v-primary); transition: background-color 0.3s; }
        .template-classic { border: 2px solid #334155; border-top: 15px solid #334155; }
        .template-classic th { background: #334155; color: white; }

        .invoice-head { 
            display: grid; 
            grid-template-columns: 160px 1fr 80px;
            align-items: center; 
            margin-bottom: 40px; 
            gap: 20px; 
            border-bottom: 1px solid var(--border-color); 
            padding-bottom: 20px; 
        }
        .logo-section { grid-column: 1 / 2; position: relative; }
        .logo-box { 
            width: 150px; 
            height: 100px; 
            border: 2px dashed var(--border-color); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            position: relative; 
            background: var(--input-bg); 
            overflow: hidden; 
        }
        #printLogo { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none; z-index: 1; }
        #printLogo img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .logo-box input { position: absolute; opacity: 0; width: 100%; height: 100%; cursor: pointer; z-index: 2; }
        .company-name-area { grid-column: 2 / 3; text-align: center; }
        .company-field { font-size: 24px; font-weight: 700; border: none; outline: none; background: var(--input-bg); color: var(--v-text); padding: 15px; border-radius: 8px; width: 100%; transition: background-color 0.3s, color 0.3s; }
        #qrcode { grid-column: 3 / 4; }

        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0; background: var(--bg-card); padding: 25px; border-radius: 12px; border: 1px solid var(--border-color); }
        .field-group { display: flex; flex-direction: column; gap: 6px; }
        .field-group label { font-size: 13px; font-weight: 700; color: var(--v-text); }
        .field-group input, .field-group select { padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; outline: none; background: var(--input-bg); color: var(--v-text); font-size: 14px; transition: background-color 0.3s, color 0.3s; width: 100%; }

        .v-table-wrapper { width: 100%; overflow-x: auto; margin: 20px 0; }
        .v-table { width: 100%; border-collapse: collapse; min-width: 600px; }
        .v-table th { padding: 12px; background: var(--bg-light); border-bottom: 2px solid var(--border-color); text-align: inherit; font-size: 14px; }
        .v-table td { padding: 12px; border-bottom: 1px solid var(--border-color); }
        .v-table input { border: none; outline: none; width: 100%; background: transparent; color: var(--v-text); }

        .sig-container { margin-top: 30px; display: flex; flex-direction: column; align-items: flex-end; }
        canvas#sig-canvas { border: 1px dashed var(--border-color); background: var(--input-bg); cursor: crosshair; touch-action: none; }

        .btn-action { width: 100%; padding: 14px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 15px; }
        .btn-download { background: var(--v-primary); color: white; }
        .btn-whatsapp { background: #22c55e; color: white; }
        .btn-secondary { background: var(--v-blue); color: white; }
        
        .tpl-btn { flex: 1; padding: 8px; border: 1px solid var(--border-color); background: var(--bg-card); color: var(--v-text); border-radius: 6px; cursor: pointer; font-size: 11px; transition: background-color 0.3s, color 0.3s; }
        .tpl-btn.active { background: var(--v-primary); color: white; border-color: var(--v-primary); }

        .section-title { font-size: 14px; font-weight: bold; margin: 20px 0 10px 0; color: var(--v-primary); border-bottom: 1px solid var(--border-color); padding-bottom: 5px; }

        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-content { background-color: var(--bg-card); padding: 35px; border-radius: 20px; width: 90%; max-width: 650px; max-height: 85vh; overflow-y: auto; box-shadow: 0 25px 60px rgba(0,0,0,0.4); position: relative; color: var(--v-text); }
        
        .badge { padding: 2px 8px; border-radius: 10px; font-size: 10px; font-weight: bold; margin-right: 5px; }
        .badge-new { background: #fef3c7; color: #92400e; }

        .client-list { margin-top: 10px; max-height: 150px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 8px; }
        .client-item { padding: 8px 12px; cursor: pointer; border-bottom: 1px solid var(--border-color); font-size: 13px; display: flex; justify-content: space-between; }
        .client-item:hover { background: var(--bg-light); }

        .calc-box { background: var(--bg-light); padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid var(--border-color); }
        .calc-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .calc-row input { flex: 1; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); font-size: 12px; width: 50%; }

        /* --- Media Queries for Mobile Fix --- */
        @media (max-width: 850px) { 
            .container { flex-direction: column; padding: 0 10px; } 
            aside.controls { width: 100%; position: relative; top: 0; margin-bottom: 20px; } 
            .card { padding: 20px; min-height: auto; }
            
            .invoice-head { 
                grid-template-columns: 1fr; 
                grid-template-rows: auto auto auto; 
                justify-items: center; 
                text-align: center;
                gap: 15px;
            }
            .logo-section { grid-column: 1 / 2; grid-row: 1 / 2; }
            .company-name-area { grid-column: 1 / 2; grid-row: 2 / 3; }
            #qrcode { grid-column: 1 / 2; grid-row: 3 / 4; }
            
            .info-grid { grid-template-columns: 1fr; gap: 15px; padding: 15px; }
            .field-group input, .field-group select { font-size: 16px; padding: 10px; } /* Larger for touch */
            
            .sig-container { align-items: center; }
            canvas#sig-canvas { width: 100%; max-width: 300px; }
        }

        @media (max-width: 480px) {
            header.vatica-nav { padding: 15px 10px; flex-direction: column; gap: 10px; }
            .vatica-logo { font-size: 22px; }
            .vatica-nav nav { gap: 8px !important; width: 100%; justify-content: center; }
            .vatica-nav nav a { font-size: 11px !important; }
            
            .card { padding: 15px; }
            .company-field { font-size: 20px; }
        }

        @media print { 
            .no-print, header, footer, aside, .assistant-bar, .seo-content, .blog-section, .modal { display: none !important; } 
            .card { box-shadow: none; border: none; width: 100%; padding: 0; margin: 0; min-height: auto; } 
            .invoice-head { border-bottom: none; padding-bottom: 0; }
        }
    </style>
</head>
<body id="body">

    <div class="assistant-bar no-print" id="assistantBar">
        <span id="txt_assistant">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ VATICA Business Suite - Ù…Ù†ØµØªÙƒ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø© ğŸš€</span>
    </div>

    <header class="vatica-nav no-print">
        <a href="/" class="vatica-logo">VATICA<span>.io</span></a>
        <nav style="display:flex; align-items:center; gap:15px;">
            <a onclick="showModal('about')" id="txt_nav_about" style="color:white; cursor:pointer; font-size:12px;">Ù…Ù† Ù†Ø­Ù†</a>
            <a onclick="showModal('privacy')" id="txt_nav_privacy" style="color:white; cursor:pointer; font-size:12px;">Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a>
            <button onclick="toggleLanguage()" id="langBtn" style="background:none; border:1px solid white; color:white; padding:5px 15px; border-radius:20px; cursor:pointer;">English</button>
            <button class="dark-mode-toggle" onclick="toggleDarkMode()">ğŸŒ™</button>
        </nav>
    </header>

    <div class="container">
        <aside class="controls no-print">
            <h3 id="txt_control">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
            
            <div class="section-title">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ <span class="badge badge-new">Ø¬Ø¯ÙŠØ¯</span></div>
            <select id="docType" onchange="updateDocType()" style="width:100%; padding:10px; border-radius:8px; border:1px solid var(--border-color); background: var(--input-bg); color: var(--v-text);">
                <option value="invoice">ÙØ§ØªÙˆØ±Ø© Ø¶Ø±ÙŠØ¨ÙŠØ©</option>
                <option value="quotation">Ø¹Ø±Ø¶ Ø³Ø¹Ø± Ø±Ø³Ù…ÙŠ</option>
            </select>

            <div class="section-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ <span class="badge badge-new">Ø¬Ø¯ÙŠØ¯</span></div>
            <button class="btn-action btn-secondary" style="font-size: 12px; padding: 8px;" onclick="showModal('addClient')">+ Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</button>
            <div class="client-list" id="clientList">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹ -->
            </div>

            <div class="section-title">Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© <span class="badge badge-new">Ø¬Ø¯ÙŠØ¯</span></div>
            <div class="calc-box">
                <div class="calc-row">
                    <input type="number" id="calcCost" placeholder="Ø§Ù„ØªÙƒÙ„ÙØ©" oninput="runCalc()">
                    <input type="number" id="calcMarkup" placeholder="Ø§Ù„Ø±Ø¨Ø­ %" oninput="runCalc()">
                </div>
                <div id="calcResult" style="font-size: 11px; font-weight: bold; color: var(--v-success); text-align: center;">Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ù…Ù‚ØªØ±Ø­: 0.00</div>
            </div>

            <div class="section-title">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</div>
            <label id="txt_curr_label" style="font-size: 11px;">Ø§Ù„Ø¹Ù…Ù„Ø©</label>
            <select id="currency" onchange="calculate()" style="width:100%; padding:10px; border-radius:8px; margin-bottom:15px; border:1px solid var(--border-color); background: var(--input-bg); color: var(--v-text);">
                <option value="SAR">SAR (Ø±ÙŠØ§Ù„)</option>
                <option value="USD">USD (Ø¯ÙˆÙ„Ø§Ø±)</option>
                <option value="AED">AED (Ø¯Ø±Ù‡Ù…)</option>
                <option value="EGP">EGP (Ø¬Ù†ÙŠÙ‡)</option>
            </select>

            <div class="vat-control">
                <label for="vatToggle" style="font-weight: bold; font-size: 12px;" id="txt_vat_label">Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© (15%)</label>
                <label class="switch">
                    <input type="checkbox" id="vatToggle" checked onchange="calculate()">
                    <span class="slider"></span>
                </label>
            </div>
            
            <button class="btn-action btn-download" id="txt_btn_print" onclick="finalizeInvoice()">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ (PDF)</button>
            <button class="btn-action btn-whatsapp" id="txt_btn_wa" onclick="sendWhatsApp()">ğŸ’¬ Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</button>
        </aside>

        <main class="editor">
            <article class="card template-modern" id="invoiceCard">
                <div class="invoice-head">
                    <div class="logo-section">
                        <div class="logo-box no-print">
                            <span id="txt_logo_up">Ø±ÙØ¹ Ø§Ù„Ø´Ø¹Ø§Ø±</span>
                            <input type="file" accept="image/*" onchange="handleLogo(this)">
                            <div id="printLogo" style="display:none;"></div>
                        </div>
                    </div>
                    <div class="company-name-area">
                        <input type="text" class="company-field" id="compName" oninput="saveComp(this.value)" placeholder="Ø§Ø³Ù… Ù…Ø¤Ø³Ø³ØªÙƒ Ù‡Ù†Ø§...">
                        <div id="docTitleDisplay" style="font-weight: bold; color: var(--v-primary); margin-top: 5px;">ÙØ§ØªÙˆØ±Ø© Ø¶Ø±ÙŠØ¨ÙŠØ©</div>
                    </div>
                    <div id="qrcode"></div>
                </div>

                <div class="info-grid">
                    <div class="field-group"><label id="txt_inv_no">Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªÙ†Ø¯</label><input type="text" id="invNum" readonly></div>
                    <div class="field-group"><label id="txt_inv_date">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±</label><input type="date" id="invDate"></div>
                    <div class="field-group"><label id="txt_client_label">Ø§Ù„Ø¹Ù…ÙŠÙ„</label><input type="text" id="clientName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„..."></div>
                    <div class="field-group"><label id="txt_tax_no">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ Ù„Ù„Ø¹Ù…ÙŠÙ„</label><input type="text" id="txt_tax_p" placeholder="300XXXXXXXXXXXX"></div>
                </div>

                <div class="v-table-wrapper">
                    <table class="v-table">
                        <thead>
                            <tr><th id="txt_th_desc">Ø§Ù„ÙˆØµÙ</th><th width="80" id="txt_th_qty">Ø§Ù„ÙƒÙ…ÙŠØ©</th><th width="120" id="txt_th_price">Ø§Ù„Ø³Ø¹Ø±</th><th width="120" id="txt_th_total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><th class="no-print" width="30"></th></tr>
                        </thead>
                        <tbody id="tbody"></tbody>
                    </table>
                </div>
                <button class="no-print" id="txt_btn_add" onclick="addRow()" style="width:100%; padding:10px; cursor:pointer; background:none; border:2px dashed var(--border-color); border-radius:8px; margin-top:10px; color: var(--v-text);">+ Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¯ Ø¬Ø¯ÙŠØ¯</button>

                <div style="display:flex; justify-content:space-between; flex-wrap:wrap; margin-top:40px; gap:30px;">
                    <div style="flex:1; min-width:250px;">
                        <label id="txt_notes_label" style="font-weight:bold; font-size:12px">Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙˆØ´Ø±ÙˆØ·:</label>
                        <textarea id="notesArea" style="width:100%; height:80px; border:1px solid var(--border-color); background: var(--input-bg); color: var(--v-text); border-radius:8px; padding:10px; resize:none;" placeholder="Ø´Ø±ÙˆØ· Ø§Ù„Ø¯ÙØ¹ØŒ Ù…Ø¯Ø© ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¹Ø±Ø¶ØŒ Ø¥Ù„Ø®..."></textarea>
                        <div id="tafqit" style="font-size:12px; color:var(--v-primary); font-weight:bold; margin-top:10px;"></div>
                    </div>
                    <div style="width:280px; background:var(--bg-light); padding:20px; border-radius:12px; border: 1px solid var(--border-color);">
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px;"><span id="txt_subtotal">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</span><span id="subTotal">0.00</span></div>
                        <div id="vatRow" style="display:flex; justify-content:space-between; margin-bottom:10px;"><span id="txt_vat">Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© (15%)</span><span id="vatAmount">0.00</span></div>
                        <div style="display:flex; justify-content:space-between; font-weight:bold; font-size:22px; color:var(--v-primary); border-top:1px solid var(--border-color); padding-top:10px;">
                            <span id="txt_grandtotal">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span><span id="grandTotal">0.00</span>
                        </div>
                    </div>
                </div>

                <div class="sig-container">
                    <canvas id="sig-canvas" width="200" height="80"></canvas>
                    <p style="font-size:10px; color:#94a3b8;" id="txt_sig_label">Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ ÙˆØ§Ù„Ø®ØªÙ… Ø§Ù„Ù…Ø¹ØªÙ…Ø¯</p>
                    <button class="no-print" onclick="clearSig()" id="txt_sig_clear" style="border:none; background:none; color:red; cursor:pointer; font-size:10px;">Ù…Ø³Ø­ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹</button>
                </div>
            </article>

            <section class="blog-section no-print">
                <h2 id="txt_blog_h">Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø¹Ø±ÙØ©: Ù†ØµØ§Ø¦Ø­ Ù„Ø¥Ø¯Ø§Ø±Ø© Ù…Ø´Ø±ÙˆØ¹Ùƒ</h2>
                <div class="blog-posts">
                    <div class="post-card">
                        <h3>Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„ÙØ§ØªÙˆØ±Ø©</h3>
                        <p>ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ù…ØªÙ‰ ÙŠØ¬Ø¨ Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø±Ø¶ Ø³Ø¹Ø± Ø±Ø³Ù…ÙŠ ÙˆÙƒÙŠÙÙŠØ© ØªØ­ÙˆÙŠÙ„Ù‡ Ø¥Ù„Ù‰ ÙØ§ØªÙˆØ±Ø© Ù…Ù„Ø²Ù…Ø© Ù‚Ø§Ù†ÙˆÙ†ÙŠØ§Ù‹ Ù„Ø¶Ù…Ø§Ù† Ø­Ù‚ÙˆÙ‚Ùƒ Ø§Ù„Ù…Ø§Ù„ÙŠØ©.</p>
                        <a href="#" onclick="return false;">Ø§Ù‚Ø±Ø£ Ø§Ù„Ù…Ø²ÙŠØ¯</a>
                    </div>
                    <div class="post-card">
                        <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ù†Ù‚Ø¯ÙŠ Ù„Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù†Ø§Ø´Ø¦Ø©</h3>
                        <p>Ù†ØµØ§Ø¦Ø­ Ø¹Ù…Ù„ÙŠØ© Ø­ÙˆÙ„ ÙƒÙŠÙÙŠØ© Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„ØªØ­ØµÙŠÙ„ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ù„Ø¶Ù…Ø§Ù† Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ù†Ù…Ùˆ Ø¹Ù…Ù„Ùƒ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ.</p>
                        <a href="#" onclick="return false;">Ø§Ù‚Ø±Ø£ Ø§Ù„Ù…Ø²ÙŠØ¯</a>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div id="modalOverlay" class="modal no-print" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div id="modalBody"></div>
            <button onclick="closeModal()" style="margin-top:20px; width:100%; padding:12px; background:var(--v-blue); color:white; border:none; border-radius:10px; cursor:pointer; font-weight:bold;">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <footer class="no-print">
        <div class="footer-links">
            <a onclick="showModal('about')">Ù…Ù† Ù†Ø­Ù†</a> | <a onclick="showModal('privacy')">Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a> | <a onclick="showModal('terms')">Ø§Ù„Ø´Ø±ÙˆØ·</a>
        </div>
        <p>Â© 2024 VATICA.io - Ø­Ù„ÙˆÙ„ Ø°ÙƒÙŠØ© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</p>
    </footer>

    <script>
        let currentLang = 'ar';
        let clients = JSON.parse(localStorage.getItem('v_clients') || '[]');

        const dict = {
            ar: {
                langBtn: "English", control: "Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…", curr_label: "Ø§Ù„Ø¹Ù…Ù„Ø©", btn_print: "ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ (PDF)", btn_wa: "ğŸ’¬ Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨", inv_no: "Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªÙ†Ø¯", inv_date: "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±", client_label: "Ø§Ù„Ø¹Ù…ÙŠÙ„", tax_no: "Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ Ù„Ù„Ø¹Ù…ÙŠÙ„", th_desc: "Ø§Ù„ÙˆØµÙ", th_qty: "Ø§Ù„ÙƒÙ…ÙŠØ©", th_price: "Ø§Ù„Ø³Ø¹Ø±", th_total: "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ", btn_add: "+ Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¯ Ø¬Ø¯ÙŠØ¯", subtotal: "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹", grandtotal: "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ", notes_label: "Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙˆØ´Ø±ÙˆØ·:", sig_label: "Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ ÙˆØ§Ù„Ø®ØªÙ… Ø§Ù„Ù…Ø¹ØªÙ…Ø¯", sig_clear: "Ù…Ø³Ø­ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹", assistant: "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ VATICA Business Suite ğŸš€", comp_p: "Ø§Ø³Ù… Ù…Ø¤Ø³Ø³ØªÙƒ Ù‡Ù†Ø§...", client_p: "Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„...", notes_p: "Ø´Ø±ÙˆØ· Ø§Ù„Ø¯ÙØ¹ØŒ Ù…Ø¯Ø© ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¹Ø±Ø¶ØŒ Ø¥Ù„Ø®...", vat_label: "Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© (15%)", vat: "Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© (15%)"
            },
            en: {
                langBtn: "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©", control: "Control Panel", curr_label: "Currency", btn_print: "ğŸ“¥ Download PDF", btn_wa: "ğŸ’¬ Send WhatsApp", inv_no: "Doc No.", inv_date: "Date", client_label: "Client", tax_no: "Client Tax ID", th_desc: "Description", th_qty: "Qty", th_price: "Price", th_total: "Total", btn_add: "+ Add Item", subtotal: "Subtotal", grandtotal: "Grand Total", notes_label: "Notes & Terms:", sig_label: "Authorized Signature & Stamp", sig_clear: "Clear Signature", assistant: "Welcome to VATICA Business Suite ğŸš€", comp_p: "Your Company Name...", client_p: "Client name...", notes_p: "Payment terms, validity, etc...", vat_label: "Tax (15%)", vat: "Tax (15%)"
            }
        };

        function renderClients() {
            const list = document.getElementById('clientList');
            list.innerHTML = clients.length ? '' : '<div style="padding:10px; font-size:11px; text-align:center;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø­ÙÙˆØ¸ÙˆÙ†</div>';
            clients.forEach((c, index) => {
                const item = document.createElement('div');
                item.className = 'client-item';
                item.innerHTML = `<span>${c.name}</span><span style="color:red;" onclick="deleteClient(${index}); event.stopPropagation();">&times;</span>`;
                item.onclick = () => selectClient(c);
                list.appendChild(item);
            });
        }

        function selectClient(c) {
            document.getElementById('clientName').value = c.name;
            document.getElementById('txt_tax_p').value = c.taxId || '';
            calculate();
        }

        function deleteClient(index) {
            clients.splice(index, 1);
            localStorage.setItem('v_clients', JSON.stringify(clients));
            renderClients();
        }

        function saveNewClient() {
            const name = document.getElementById('newClientName').value;
            const taxId = document.getElementById('newClientTax').value;
            if(!name) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„");
            clients.push({ name, taxId });
            localStorage.setItem('v_clients', JSON.stringify(clients));
            renderClients();
            closeModal();
        }

        function runCalc() {
            const cost = parseFloat(document.getElementById('calcCost').value) || 0;
            const markup = parseFloat(document.getElementById('calcMarkup').value) || 0;
            const result = cost + (cost * (markup / 100));
            document.getElementById('calcResult').innerText = `Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ù…Ù‚ØªØ±Ø­: ${result.toFixed(2)}`;
        }

        function updateDocType() {
            const type = document.getElementById('docType').value;
            const title = type === 'invoice' ? (currentLang === 'ar' ? 'ÙØ§ØªÙˆØ±Ø© Ø¶Ø±ÙŠØ¨ÙŠØ©' : 'Tax Invoice') : (currentLang === 'ar' ? 'Ø¹Ø±Ø¶ Ø³Ø¹Ø± Ø±Ø³Ù…ÙŠ' : 'Official Quotation');
            document.getElementById('docTitleDisplay').innerText = title;
            document.getElementById('notesArea').placeholder = type === 'invoice' ? dict[currentLang].notes_p : (currentLang === 'ar' ? 'ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¹Ø±Ø¶ØŒ Ø´Ø±ÙˆØ· Ø§Ù„ØªÙˆØ±ÙŠØ¯...' : 'Validity, delivery terms...');
        }

        function toggleLanguage() {
            currentLang = (currentLang === 'ar') ? 'en' : 'ar';
            document.getElementById('htmlRoot').dir = (currentLang === 'ar') ? 'rtl' : 'ltr';
            document.getElementById('langBtn').innerText = dict[currentLang].langBtn;
            Object.keys(dict[currentLang]).forEach(key => {
                const el = document.getElementById('txt_' + key);
                if (el) el.innerText = dict[currentLang][key];
            });
            updateDocType();
            calculate();
        }

        function toggleDarkMode() { document.body.classList.toggle('dark-mode'); }

        function handleLogo(input) {
            const reader = new FileReader();
            reader.onload = (e) => { localStorage.setItem('v_logo', e.target.result); renderLogo(e.target.result); };
            reader.readAsDataURL(input.files[0]);
        }
        function renderLogo(d) {
            document.getElementById('txt_logo_up').style.display = 'none';
            const printLogo = document.getElementById('printLogo');
            printLogo.innerHTML = `<img src="${d}" style="max-width:100%; max-height:100%; object-fit:contain;">`;
            printLogo.style.display = 'block';
        }

        function calculate() {
            let sub = 0; 
            const curr = document.getElementById("currency").value;
            const vatEnabled = document.getElementById("vatToggle").checked;
            document.querySelectorAll("#tbody tr").forEach(row => {
                const q = Math.max(0, parseFloat(row.querySelector(".qty").value) || 0);
                const p = Math.max(0, parseFloat(row.querySelector(".price").value) || 0);
                row.querySelector(".line-total").innerText = (q * p).toFixed(2);
                sub += (q * p);
            });
            let vatAmount = vatEnabled ? sub * 0.15 : 0;
            let total = sub + vatAmount;
            document.getElementById("subTotal").innerText = sub.toFixed(2) + " " + curr;
            document.getElementById("vatAmount").innerText = vatAmount.toFixed(2) + " " + curr;
            document.getElementById("grandTotal").innerText = total.toFixed(2) + " " + curr;
            document.getElementById("tafqit").innerText = (currentLang === 'ar' ? "Ø§Ù„Ù…Ø¨Ù„Øº ÙƒØªØ§Ø¨Ø©: " : "In Words: ") + total.toFixed(2) + " " + curr;
            updateQR(total, curr);
        }

        function updateQR(t, c) {
            const qr = document.getElementById("qrcode"); qr.innerHTML = "";
            if (typeof QRCode !== 'undefined') { new QRCode(qr, { text: "VATICA: " + t.toFixed(2) + " " + c, width: 80, height: 80 }); }
        }

        function addRow() {
            const tbody = document.getElementById("tbody");
            const row = document.createElement("tr");
            row.innerHTML = `
                <td><input type="text" placeholder="..."></td>
                <td><input type="number" class="qty" value="1" oninput="calculate()"></td>
                <td><input type="number" class="price" value="0.00" oninput="calculate()"></td>
                <td style="font-weight:bold" class="line-total">0.00</td>
                <td class="no-print"><button onclick="this.closest('tr').remove(); calculate();" style="color:red; border:none; background:none; cursor:pointer;">&times;</button></td>
            `;
            tbody.appendChild(row); calculate();
        }

        function showModal(t) {
            let content = '';
            if(t === 'addClient') {
                content = `<h2>Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</h2>
                           <input type="text" id="newClientName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„" style="width:100%; padding:10px; margin-bottom:10px; border-radius:8px; border:1px solid #ccc;">
                           <input type="text" id="newClientTax" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" style="width:100%; padding:10px; margin-bottom:10px; border-radius:8px; border:1px solid #ccc;">
                           <button onclick="saveNewClient()" style="width:100%; padding:10px; background:var(--v-primary); color:white; border:none; border-radius:8px;">Ø­ÙØ¸ Ø§Ù„Ø¹Ù…ÙŠÙ„</button>`;
            } else if(t === 'about') {
                content = `<h2>Ù…Ù† Ù†Ø­Ù†</h2><p>VATICA Business Suite Ù‡ÙŠ Ù…Ù†ØµØ© Ù…ØªÙƒØ§Ù…Ù„Ø© ØªÙ‡Ø¯Ù Ù„ØªØ¨Ø³ÙŠØ· Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© Ù„Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„ØµØºÙŠØ±Ø© ÙˆØ§Ù„Ù…ØªÙˆØ³Ø·Ø© Ø¹Ø¨Ø± Ø£Ø¯ÙˆØ§Øª Ø°ÙƒÙŠØ© ÙˆÙ…Ø¬Ø§Ù†ÙŠØ©.</p>`;
            } else if(t === 'privacy') {
                content = `<h2>Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</h2><p>Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù…Ù„ÙƒÙƒ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„. Ù†Ø­Ù† Ù„Ø§ Ù†Ø®Ø²Ù† Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù„Ù‰ Ø®ÙˆØ§Ø¯Ù…Ù†Ø§Ø› ÙƒÙ„ Ø´ÙŠØ¡ ÙŠØªÙ… Ø­ÙØ¸Ù‡ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙŠ Ù…ØªØµÙØ­Ùƒ Ù„Ø¶Ù…Ø§Ù† Ø£Ù‚ØµÙ‰ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†.</p>`;
            }
            document.getElementById('modalBody').innerHTML = content;
            document.getElementById('modalOverlay').style.display = 'flex';
        }

        function closeModal() { document.getElementById('modalOverlay').style.display = 'none'; }

        function finalizeInvoice() { 
            let currentInvNum = parseInt(document.getElementById('invNum').value);
            localStorage.setItem('v_count', currentInvNum + 1); 
            window.print(); 
        }

        const canvas = document.getElementById('sig-canvas');
        const ctx = canvas.getContext('2d');
        let drawing = false;
        if (canvas) {
            const getPos = (e) => {
                const rect = canvas.getBoundingClientRect();
                const cx = e.touches ? e.touches[0].clientX : e.clientX;
                const cy = e.touches ? e.touches[0].clientY : e.clientY;
                return { x: cx - rect.left, y: cy - rect.top };
            };
            canvas.addEventListener('mousedown', (e) => { drawing = true; const p = getPos(e); ctx.beginPath(); ctx.moveTo(p.x, p.y); });
            canvas.addEventListener('mousemove', (e) => { if(!drawing) return; const p = getPos(e); ctx.lineTo(p.x, p.y); ctx.stroke(); });
            window.addEventListener('mouseup', () => drawing = false);
            canvas.addEventListener('touchstart', (e) => { e.preventDefault(); drawing = true; const p = getPos(e); ctx.beginPath(); ctx.moveTo(p.x, p.y); });
            canvas.addEventListener('touchmove', (e) => { e.preventDefault(); if(!drawing) return; const p = getPos(e); ctx.lineTo(p.x, p.y); ctx.stroke(); });
            canvas.addEventListener('touchend', () => drawing = false);
        }
        function clearSig() { ctx.clearRect(0, 0, canvas.width, canvas.height); }

        document.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('v_comp_name'); if(saved) document.getElementById('compName').value = saved;
            const logo = localStorage.getItem('v_logo'); if(logo) renderLogo(logo);
            document.getElementById('invDate').valueAsDate = new Date();
            document.getElementById('invNum').value = localStorage.getItem('v_count') || 1001;
            if (document.querySelectorAll("#tbody tr").length === 0) addRow();
            renderClients();
            currentLang = 'en'; toggleLanguage();
        });
    </script>
</body>
</html>
